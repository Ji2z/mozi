# AWS



## ğŸ’ì ‘ì† ë°©ë²•

1. pemí‚¤ ë‹¤ìš´ë¡œë“œ (C:\Users\multicampusì— ë‹¤ìš´)

   [J5A603T.pem](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/1ac40afe-3af7-4ad1-8604-2336239a6bfa/J5A603T.pem)

2. cmd ì‹¤í–‰

3. `ssh -i J5A603T.pem ubuntu@j5a603.p.ssafy.io`ì…ë ¥

## IP ì£¼ì†Œ

internal ip address(private)

`curl <http://169.254.169.254/latest/meta-data/local-ipv4`>

172.26.2.95

public ip address

`curl <http://169.254.169.254/latest/meta-data/public-ipv4`>

13.125.235.138



## ğŸš¨ ì£¼ì˜ì‚¬í•­

1. ë°©í™”ë²½ì€ ì—†ìŒ, ê´€ë ¨ ì„¤ì • ë¶ˆ í•„ìš”

2. ì•„ë˜ ëª…ë ¹ì–´ë“¤ì„ ì˜ëª» ì‚¬ìš©ì‹œ, ì‹œìŠ¤í…œì´ ë³µêµ¬ ë¶ˆëŠ¥ ë  ìˆ˜ ìˆìŒ, ì‚¬ì‹¤ PJTì—ì„œ ì‚¬ìš© í•  ì¼ ì—†ìŒ.

   - sudo ufw
   - sudo iptables
   - sudo chmod
   - sudo poweroff
   - sudo shutdown
   - sudo halt
   - sudo init
   - sudo rm -rf /

3. ì¬ë¶€íŒ… ì›í•˜ë©´ sudo reboot ë§Œ ì‚¬ìš©

4. port ì‚¬ìš© ë²”ìœ„

   22, 80, 443, 3000-3999, 8000-8999, 5000



# ë°°í¬ ì ˆì°¨

### ê³¼ì •

- Docker
- Jenkins ì„¤ì¹˜
- Jenkins ì„¤ì •
- AWS ì„œë²„ ì„¤ì •
- Pipeline ì‘ì„±
- Frontend ë°°í¬
- Backend ë°°í¬





- 1. Jenkins ì„¤ì¹˜ ë° ì»¨í…Œì´ë„ˆ ì‹¤í–‰

  ì°¸ê³  : https://insight-bgh.tistory.com/250

- 1. ê¸°ë³¸ ì„¤ì •

  ì°¸ê³  : https://edu.ssafy.com/data/upload_files/crossUpload/openLrn/ebook/unzip/A2021062917100034100/index.html

  1. í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜

     ![1_ë°°í¬ì„¤ì¹˜](/uploads/1fa55ca27c0f8561996fcf9d6c45eb22/1_ë°°í¬ì„¤ì¹˜.png)

  2. Jenkins ê´€ë¦¬ > Global Tool Configuration > Maven

     ![1_ì  í‚¨ìŠ¤](/uploads/31872fd9fa6dd55ad406d8f01bd8ea3f/1_ì  í‚¨ìŠ¤.png)

- 1. Pipeline ìƒì„±

  ì°¸ê³  : https://twofootdog.github.io/Docker-Dockerì»¨í…Œì´ë„ˆë¡œ-jenkins-ì‹¤í–‰-í›„-ì†ŒìŠ¤-push-ì‹œ-ìë™-ë¹Œë“œë°°í¬í•˜ê¸°(Springboot)/

  1. Pipleline SCM ì„¤ì •

     ![1_3_1_](/uploads/d0fada3064d31e2b543f855818777fcb/1_3_1_.png)

  2. Script Path ì„¤ì •

     ![1_3_2_](/uploads/6dff8d36c0753ed7975cb1fc3876d402/1_3_2_.png)

  3. Dockerfile ì‘ì„±

     ###### F/E

     ```docker
     
     # build stage
     FROM node:lts-alpine as build-stage
     WORKDIR /app
     
     COPY package*.json ./
     RUN npm install
     COPY ./ .
     RUN npm run build
     
     # production stage
     FROM nginx:stable-alpine as production-stage
     
     RUN mkdir /app
     COPY --from=build-stage /app/dist /app
     COPY nginx.conf /etc/nginx/nginx.conf 
     
     EXPOSE 3000
     CMD ["nginx", "-g", "daemon off;"]
     
     ```

     ###### B/E

     ```docker
     
     FROM openjdk:8-jdk-alpine as builder
     WORKDIR /backend
     COPY . .
     RUN chmod +x ./gradlew
     
     RUN ./gradlew clean build
     
     FROM adoptopenjdk:8-jre-hotspot 
     COPY --from=builder /backend/build/libs/mozi-0.0.1-SNAPSHOT.jar app.jar
     
     EXPOSE 8080
     ENTRYPOINT ["java", "-jar", "./app.jar"]
     
     ```

     â€‹	

  4. Jenkinsfile ì‘ì„±

     ```jsx
     pipeline {
         agent none
         options { skipDefaultCheckout(true) }
         stages {
             stage('Build and Test') {
                 agent {
                     docker {
                         image 'maven:3-alpine'
                         args '-v /root/.m2:/root/.m2'
                     }
                 }
                 options { skipDefaultCheckout(false) }
                 steps {
     								// maven ìœ¼ë¡œ spring boot ë¹Œë“œ, ê¹ƒ ë‚´ë¶€ì— ë°”ë¡œ íŒŒì¼ì´ ìˆëŠ”ê²Œ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ê²½ë¡œ ì„¤ì • í•„ìˆ˜
                     sh 'mvn -f /var/jenkins_home/workspace/ovl/backend/pom.xml -B -DskipTests clean package'
                 }
             }
             stage('Docker build') {
                 agent any
                 steps {
     							// ë¹Œë“œí•œ jar íŒŒì¼ë¡œ Docker ì´ë¯¸ì§€ ìƒì„±
     					    sh 'docker build -t backend:latest /var/jenkins_home/workspace/ovl/backend'
                 }
             }
             stage('Docker run') {
                 agent any
                 steps {
     								// Dockerì— ì´ë¦„ì´ backendì¸ ì»¨í…Œì´ë„ˆê°€ ì´ë¯¸ ìˆë‹¤ë©´ stop
                     sh 'docker ps -f name=backend -q | xargs --no-run-if-empty docker container stop'
     								// ì´ë¦„ì´ backendì¸ ì»¨í…Œì´ë„ˆ ì‚­ì œ
     						    sh 'docker container ls -a -fname=name=backend -q | xargs -r docker container rm'
     								// ì´ë¯¸ì§€ ì¼ê´„ ì‚­ì œ
     						    sh 'docker images -f dangling=true && docker rmi -f $(docker images -f dangling=true -q)' 
     								// ì»¨í…Œì´ë„ˆ ì‹¤í–‰
     						    sh 'docker run -d --name backend -p 8080:8080 backend:latest'
                 }
             }
         }
     }
     ```

[swagger](http://j5a603.p.ssafy.io:8080/api/swagger-ui.html#/)

curl ëª…ë ¹ì–´

```jsx
curl -X GET "<http://j5a603.p.ssafy.io:8080/api/beverage/search?name=%EB%AA%AC%EC%8A%A4%ED%84%B0%EC%97%90%EB%84%88%EC%A7%80%20%EC%9A%B8%ED%8A%B8%EB%9D%BC&type=%EC%BA%94>" -H "accept: */*"
ssh -i J5A603T.pem ubuntu@j5a603.p.ssafy.io
```

webhook ì„¤ì •

https://lab.ssafy.com/s05-ai-speech/S05P21A603/-/hooks

jenkins ì„¤ì •

http://j5a603.p.ssafy.io:9090/job/mozi/configure